import{r as t,j as e,$ as h,i as p,k as v,F as x,m as j,c as g,a as N,n as b,o as y,p as O,O as C}from"./index-c0460ba7.js";import{a as R,b as S,H as k}from"./Header-1b62bcc8.js";import{C as D,s as E}from"./scrollIntoView-4195a225.js";function f(i){const a=new Date(i),r=["January","February","March","April","May","June","July","August","September","October","November","December"],s=a.getFullYear(),c=r[a.getMonth()],n=a.toISOString().split("T")[0];return{month:c,year:s,dateTime:n,mothYear:`${c} ${s}`}}const $=t.memo(i=>{const{reviews:a}=i,r=t.useCallback(s=>20*s,[]);return a.length===0?null:e.jsx("ul",{className:"reviews__list",children:a.map(s=>e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${r(s.rating)}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:f(s.date).dateTime,children:f(s.date).mothYear})]})]},s.id))})}),H=async({offerId:i,rating:a,comment:r})=>{const s=await h.post(`/comments/${i}`,{rating:a,comment:r});if(!s.data)throw new Error("Could not create review");return s.data},T=async i=>{const a=await h.get(`/comments/${i}`);if(!a.data)throw new Error("Could not find review");return a.data},F=t.memo(i=>{const{id:a,onPost:r}=i,[s,c]=t.useState({rating:0,comment:""}),n=p(),m=t.useCallback(d=>{d.stopPropagation(),d.preventDefault(),a&&H({offerId:a,rating:s.rating,comment:s.comment}).then(o=>{r==null||r(o)}).catch(o=>v(o))},[a,r,s.comment,s.rating]),u=t.useCallback(d=>{const o=d.target.value;c(w=>({...w,comment:o}))},[]),l=t.useCallback(d=>{c(o=>({...o,rating:d}))},[]),_=t.useMemo(()=>!(s.rating===0||!s.comment||s.comment.length<50),[s.comment,s.rating]);return!n||!a?null:e.jsxs("form",{className:"reviews__form form",action:"#",method:"post",onSubmit:m,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx(x,{className:"reviews__rating-form ",onChange:l}),e.jsx("textarea",{onChange:u,className:"reviews__textarea form__textarea",id:"review",name:"review",value:s.comment,placeholder:"Tell how was your stay, what you like and what can be improved"}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least"," ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!_,children:"Submit"})]})]})}),A=t.memo(i=>{const{id:a}=i,[r,s]=t.useState([]);t.useEffect(()=>{a&&T(a).then(n=>s(n)).catch(n=>v(n))},[a]);const c=t.useCallback(n=>{s(m=>[...m,n])},[]);return e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews Â·"," ",e.jsx("span",{className:"reviews__amount",children:r.length})]}),e.jsx($,{reviews:r}),e.jsx(F,{id:a,onPost:c})]})}),Y=t.memo(()=>{const{id:i}=j(),a=g(),r=R(),s=S(),[c,n]=t.useState(null),m=N(),u=t.useCallback(l=>{n(l)},[]);return t.useEffect(()=>{i&&(window.scrollTo({top:0,behavior:"smooth"}),a(b(i)).then(l=>{l.meta.requestStatus==="rejected"&&m("/404")}))},[a,i,m]),t.useEffect(()=>{s&&a(y({id:s.id,city:s.city.name}))},[a,s]),s?e.jsxs("div",{className:"page",children:[e.jsx(k,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsx(O,{offer:s,reviews:e.jsx(A,{id:s.id})}),e.jsx("section",{className:"offer__map map",children:e.jsx(D,{city:s.city.name,offers:r,selectedOffer:c,onPointClick:l=>{E(`#${l}`)}})}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx("div",{className:"near-places__list places__list",children:e.jsx(C,{offers:r,onActiveOffer:u})})]})})]})]}):null});export{Y as default};
